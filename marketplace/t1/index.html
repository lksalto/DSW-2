<!DOCTYPE html>
<html class="">

<head>
    <meta charset='utf-8'>
    <title>Laboratório</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href="tailwindOutput.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <script>
        let cartCount = 0;
        let discosData = [];

        // Load discs from the JSON file
        function loadDiscos() {
            fetch('discos.json')
                .then(response => response.json())
                .then(discos => {
                    discosData = discos; // Save data for filtering
                    populateGeneros(discos); // Populate genres dropdown
                    displayDiscos(discos); // Show all discos initially
                });
        }

        // Display discos in the container
        function displayDiscos(discos) {
            const produtosContainer = document.getElementById('produtos-container');
            produtosContainer.innerHTML = ''; // Clear existing products

            discos.forEach(disco => {
                const preco = parseFloat(disco.preco);

                const produtoElement = document.createElement('div');
                produtoElement.classList.add('bg-gray-100', 'dark:bg-gray-800', 'rounded-lg', 'shadow-lg', 'flex', 'flex-col', 'items-center', 'p-4', 'relative');

                // Tooltip element
                const tooltipElement = document.createElement('div');
                tooltipElement.classList.add('absolute', 'bottom-16', 'left-0', 'bg-gray-800', 'text-white', 'rounded-md', 'p-2', 'text-xs', 'hidden');
                tooltipElement.innerHTML = `
                    <p><strong>Nome:</strong> ${disco.nome}</p>
                    <p><strong>Artista:</strong> ${disco.artista}</p>
                    <p><strong>Preço:</strong> R$ ${preco.toFixed(2)}</p>
                    <p><strong>Gênero:</strong> ${disco.genero}</p>
                `;

                // Add tooltip to product element
                produtoElement.appendChild(tooltipElement);

                produtoElement.innerHTML += `
                    <img src="${disco.imagem}" alt="${disco.nome}" class="w-full h-40 object-cover rounded-t-lg" onmouseover="showTooltip(event)" onmouseout="hideTooltip(event)">
                    <h3 class="mt-4 text-lg font-bold text-gray-800 dark:text-white">${disco.nome}</h3>
                    <p class="text-green-600 dark:text-green-400 font-semibold mt-2">R$ ${preco.toFixed(2)}</p>
                    <button onclick="addToCart()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                        Adicionar ao Carrinho
                    </button>
                `;

                produtosContainer.appendChild(produtoElement);
            });
        }

        // Populate genres dropdown
        function populateGeneros(discos) {
            const generoFiltro = document.getElementById('generoFiltro');
            const generos = new Set();

            discos.forEach(disco => generos.add(disco.genero));

            generoFiltro.innerHTML = '<option value="all">Todos</option>';

            generos.forEach(genero => {
                const option = document.createElement('option');
                option.value = genero;
                option.textContent = genero.charAt(0).toUpperCase() + genero.slice(1);
                generoFiltro.appendChild(option);
            });
        }

        // Filter discs by genre
        function filterByGenero(genero) {
            const filteredDiscos = genero === 'all' ? discosData : discosData.filter(disco => disco.genero === genero);
            displayDiscos(filteredDiscos);
        }

        // Trigger filtering when the genre dropdown changes
        function filterDiscos() {
            const generoFiltro = document.getElementById('generoFiltro').value;
            filterByGenero(generoFiltro);
        }

        // Toggle the visibility of the menu
        function toggleMenu() {
            var x = document.getElementById("menu");
            if (x.style.display === "none" || x.style.display === "") {
                x.style.display = "flex";
            } else {
                x.style.display = "none";
            }
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const htmlElement = document.documentElement;
            if (htmlElement.classList.contains('dark')) {
                htmlElement.classList.remove('dark');
            } else {
                htmlElement.classList.add('dark');
            }
        }

        // Add an item to the shopping cart
        function addToCart() {
            cartCount++;
            document.getElementById("cart-count").textContent = cartCount;
        }

        // Show tooltip on hover
        function showTooltip(event) {
            const tooltip = event.target.closest('div').querySelector('.absolute');
            tooltip.classList.remove('hidden');
        }

        // Hide tooltip when not hovering
        function hideTooltip(event) {
            const tooltip = event.target.closest('div').querySelector('.absolute');
            tooltip.classList.add('hidden');
        }

        // Initialize the page by loading discs
        window.onload = loadDiscos;
    </script>
</head>

<body class="w-full flex flex-col font-mono bg-indigo-100 dark:bg-gray-900 dark:text-white">

    <div class="fixed top-0 left-0 w-full h-14 p-4 flex flex-row justify-between
    bg-indigo-200 border-b border-b-gray-300 dark:bg-gray-900
    dark:border-b-gray-800 z-10">
        <div class="flex flex-row items-center gap-x-4 ">
            <div onclick="toggleMenu()" class="flex items-center justify-center
            select-none cursor-pointer text-gray-500 hover:text-indigo-700
            active:text-red-500 dark:hover:text-indigo-400
            dark:active:text-red-500">
                <i class="material-icons">menu</i>
            </div>

            <div class="font-bold text-2xl cursor-pointer
            select-none text-indigo-600 dark:text-yellow-300">Toca Do Disco</div>
            <div id="menu" class="fixed top-14 left-0 w-full z-10 hidden
            flex-col p-8 gap-y-2 text-lg font-bold bg-gray-200
            dark:bg-gray-900">
                <div class="p-2 cursor-pointer select-none hover:text-indigo-700
                dark:hover:text-indigo-300"><a href="index.html">Página Inicial</a></div>
                <div class="p-2 cursor-pointer select-none hover:text-indigo-700
                dark:hover:text-indigo-300"><a href="login.html">Login</a></div>
                <div class="p-2 cursor-pointer select-none hover:text-indigo-700
                dark:hover:text-indigo-300"><a href="cadastro.html">Cadastro</a></div>
            </div>
        </div>
        <div class="flex flex-row gap-x-2">
            <div class="flex items-center cursor-pointer select-none text-black hover:text-yellow-500 dark:text-white">
                <i class="material-icons">shopping_cart</i>
                <span id="cart-count" class="ml-2 text-sm text-red-500">0</span>
            </div>

            <div onclick="toggleDarkMode()" class="select-none cursor-pointer
            text-black hover:text-yellow-500 dark:text-white">
                <div class="text-xs dark:hidden">
                    <i class="material-icons">nightlight</i>
                </div>
                <div class="text-xs hidden dark:block">
                    <i class="material-icons">lightbulb</i>
                </div>
            </div>
        </div>
    </div>

    <div class="flex-col w-full">
        <img src="images/banner.jpg" 
             alt="Descrição da Imagem" 
             class="w-full h-64 object-cover">
    </div>

    <div class="w-full p-4 flex justify-center items-center gap-4 bg-indigo-300 dark:bg-gray-800">
        <label for="generoFiltro" class="text-indigo-800 dark:text-yellow-300">Filtrar por gênero:</label>
        <select id="generoFiltro" onchange="filterDiscos()" class="p-2 bg-gray-200 dark:bg-gray-600 rounded-lg"></select>
    </div>
    
    <div class="flex-col p-8">
        <div id="produtos-container" class="grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        </div>
    </div>
</body>

</html>
